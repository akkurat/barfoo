import restify from 'restify';
const testFolder = '/Users/moritz/Downloads/series/Die Ärzte - DUNKEL (2021) FLAC [PMEDIA] ⭐️';
import fs from 'fs';
import path from 'path';
import { Song } from './schema/song';
import { connect } from 'mongoose';
async function main() {
    await connect('mongodb://localhost:27017/test');
    fs.readdir(testFolder, (err, files) => {
        files.forEach(f => {
            const song = new Song({ name: f });
            song.save();
        });
    });
}
main().catch(err => console.log(err));
const respond = async (req, res, next) => {
    const songs = await Song.find().exec();
    res.send(200, { req: req.params, files: songs.map(f => ({ name: f.name, path: path.join('/stream/songs/' + testFolder, f.name) })) });
    next();
};
const stream = (req, res, next) => {
    console.log(req);
    const p1 = '/' + req.params['*'];
    if (fs.existsSync(p1)) {
        const stream = fs.createReadStream(p1);
        res.writeHead(200);
        stream.pipe(res);
    }
    else {
        res.send(404);
    }
};
var server = restify.createServer();
server.get('/api/:name', respond);
server.head('/api/:name', respond);
server.get('/stream/songs/*', stream);
server.listen(8080, function () {
    console.log('%s listening at %s', server.name, server.url);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXgtb2xkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vaW5kZXgtb2xkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sT0FBMkIsTUFBTSxTQUFTLENBQUE7QUFDakQsTUFBTSxVQUFVLEdBQUcsMkVBQTJFLENBQUM7QUFDL0YsT0FBTyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ3BCLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUN4QixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXJDLE9BQU8sRUFBQyxPQUFPLEVBQUMsTUFBTSxVQUFVLENBQUE7QUFFaEMsS0FBSyxVQUFVLElBQUk7SUFDakIsTUFBTSxPQUFPLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztJQUNoRCxFQUFFLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsRUFBRTtRQUNwQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ2hCLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUE7WUFDbEMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFBO1FBQ2IsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUM7QUFHRCxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFNdEMsTUFBTSxPQUFPLEdBQW1CLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFO0lBRXZELE1BQU0sS0FBSyxHQUFHLE1BQU0sSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksRUFBRSxDQUFBO0lBQ3RDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsVUFBVSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUE7SUFDckksSUFBSSxFQUFFLENBQUM7QUFFVCxDQUFDLENBQUE7QUFJRCxNQUFNLE1BQU0sR0FBbUIsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFO0lBQ2hELE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDaEIsTUFBTSxFQUFFLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7SUFFaEMsSUFBSSxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxFQUFFO1FBQ3JCLE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUN0QyxHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ2xCLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7S0FDakI7U0FDSTtRQUNILEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7S0FDZDtBQUlILENBQUMsQ0FBQTtBQUtELElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztBQUNwQyxNQUFNLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNsQyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNuQyxNQUFNLENBQUMsR0FBRyxDQUFDLGlCQUFpQixFQUFFLE1BQU0sQ0FBQyxDQUFBO0FBRXJDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFO0lBQ2xCLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLEVBQUUsTUFBTSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDN0QsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcmVzdGlmeSwgeyBSZXF1ZXN0SGFuZGxlciB9IGZyb20gJ3Jlc3RpZnknXG5jb25zdCB0ZXN0Rm9sZGVyID0gJy9Vc2Vycy9tb3JpdHovRG93bmxvYWRzL3Nlcmllcy9EaWUgw4RyenRlIC0gRFVOS0VMICgyMDIxKSBGTEFDIFtQTUVESUFdIOKtkO+4jyc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBTb25nIH0gZnJvbSAnLi9zY2hlbWEvc29uZyc7XG5cbmltcG9ydCB7Y29ubmVjdH0gZnJvbSAnbW9uZ29vc2UnXG5cbmFzeW5jIGZ1bmN0aW9uIG1haW4oKSB7XG4gIGF3YWl0IGNvbm5lY3QoJ21vbmdvZGI6Ly9sb2NhbGhvc3Q6MjcwMTcvdGVzdCcpO1xuICBmcy5yZWFkZGlyKHRlc3RGb2xkZXIsIChlcnIsIGZpbGVzKSA9PiB7XG4gICAgZmlsZXMuZm9yRWFjaChmID0+IHtcbiAgICAgIGNvbnN0IHNvbmcgPSBuZXcgU29uZyh7IG5hbWU6IGYgfSlcbiAgICAgIHNvbmcuc2F2ZSgpXG4gICAgfSlcbiAgfSlcbn1cblxuXG5tYWluKCkuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpO1xuXG5cblxuXG5cbmNvbnN0IHJlc3BvbmQ6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG5cbiAgY29uc3Qgc29uZ3MgPSBhd2FpdCBTb25nLmZpbmQoKS5leGVjKClcbiAgcmVzLnNlbmQoMjAwLCB7IHJlcTogcmVxLnBhcmFtcywgZmlsZXM6IHNvbmdzLm1hcChmID0+ICh7IG5hbWU6IGYubmFtZSwgcGF0aDogcGF0aC5qb2luKCcvc3RyZWFtL3NvbmdzLycgKyB0ZXN0Rm9sZGVyLCBmLm5hbWUpIH0pKSB9KVxuICBuZXh0KCk7XG5cbn1cblxuXG5cbmNvbnN0IHN0cmVhbTogUmVxdWVzdEhhbmRsZXIgPSAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgY29uc29sZS5sb2cocmVxKVxuICBjb25zdCBwMSA9ICcvJyArIHJlcS5wYXJhbXNbJyonXVxuXG4gIGlmIChmcy5leGlzdHNTeW5jKHAxKSkge1xuICAgIGNvbnN0IHN0cmVhbSA9IGZzLmNyZWF0ZVJlYWRTdHJlYW0ocDEpXG4gICAgcmVzLndyaXRlSGVhZCgyMDApXG4gICAgc3RyZWFtLnBpcGUocmVzKVxuICB9XG4gIGVsc2Uge1xuICAgIHJlcy5zZW5kKDQwNClcbiAgfVxuXG5cblxufVxuXG5cblxuXG52YXIgc2VydmVyID0gcmVzdGlmeS5jcmVhdGVTZXJ2ZXIoKTtcbnNlcnZlci5nZXQoJy9hcGkvOm5hbWUnLCByZXNwb25kKTtcbnNlcnZlci5oZWFkKCcvYXBpLzpuYW1lJywgcmVzcG9uZCk7XG5zZXJ2ZXIuZ2V0KCcvc3RyZWFtL3NvbmdzLyonLCBzdHJlYW0pXG5cbnNlcnZlci5saXN0ZW4oODA4MCwgZnVuY3Rpb24gKCkge1xuICBjb25zb2xlLmxvZygnJXMgbGlzdGVuaW5nIGF0ICVzJywgc2VydmVyLm5hbWUsIHNlcnZlci51cmwpO1xufSk7Il19